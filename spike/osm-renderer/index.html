<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ptolemy</title>
  <script src="src/core.js"></script>
  <script src="src/tiles.js"></script>
  <script src="src/render.js"></script>
  <script src="src/binary.js"></script>
  <style>
polyline {
  fill: none; stroke: black; stroke-width: 0.5px;
}
canvas {
  border: 1px solid black;
}
  </style>
</head>
<body>
  <canvas id="canvas" height="570" width="700"></canvas>

  <script type="text/javascript">
    var CURRENT_ZOOM = 15;

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');

    function readAndRenderBinary() {
      getBinaryTileFile('data.binary', function(error, mapData) {
        if (error) {
          throw error;
        }

        MAP_DATA = mapData;

        // --- Translate the canvas context to make drawing go at the right spot ---
        var bounds = mapData.bounds;

        var tileMin = getTileFromMeter(bounds.minX, bounds.minY, CURRENT_ZOOM);
        var tileMax = getTileFromMeter(bounds.maxX, bounds.maxY, CURRENT_ZOOM);

        var tileXCount = tileMax[0] - tileMin[0] + 1;
        var tileYCount = tileMax[1] - tileMin[1] + 1;

        // --- Add margin around the map and color background ---
        var mapMargin = 10;

        var canvasWidth = tileXCount * TILE_SIZE;
        var canvasHeight = tileYCount * TILE_SIZE;

        canvas.width = canvasWidth + 2 * mapMargin;
        canvas.height = canvasHeight + 2 * mapMargin;

        ctx.translate(mapMargin, mapMargin);

        // Draw the background of the map.
        ctx.fillStyle = 'rgb(237, 230, 220)';
        ctx.fillRect(0, 0, canvasWidth, canvasHeight);

        // --- Draw the individual tiles of the map ---

        for (var x = 0; x < tileXCount; x++) {
          for (var y = 0; y < tileYCount; y++) {
            ctx.save();
            ctx.translate(x * TILE_SIZE, y * TILE_SIZE);

            renderTile(x + tileMin[0], y + tileMin[1], CURRENT_ZOOM, ctx, mapData);

            ctx.restore();
          }
        }
      });
    }

    readAndRenderBinary();

  </script>

</body>
</html>
