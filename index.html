<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ptolemy</title>
  <script type="text/javascript" src="src/core.js"></script>
  <script type="text/javascript" src="src/util.js"></script>
  <script type="text/javascript" src="src/worker.js"></script>
  <script type="text/javascript">

    // requestAnimationFrame polyfill
    var requestAnimationFrame = (function(){
      return  window.requestAnimationFrame       ||
              window.webkitRequestAnimationFrame ||
              window.mozRequestAnimationFrame    ||
              function( callback ){
                window.setTimeout(callback, 1000 / 60);
              };
    })();

    PTOLEMY.enableWorker = location.hash.indexOf('disableWorker') === -1;
    PTOLEMY.workerSrc = 'src/worker_loader.js';
    PTOLEMY.boot();
    var send = PTOLEMY.handler.send.bind(PTOLEMY.handler);
    var svgns = "http://www.w3.org/2000/svg";
    var start = new Date();
    console.log("start", start.toString());
    send('start', 'worker_main.js', function(data, promise) {
      var svg = document.getElementById('svg');
      send('tile', null, function(data, promise) {
        if (data.type === "FeatureCollection") {
          var parent = svg.parentNode;
          svg.parentNode.removeChild(svg);
          for (var i = 0; i < data.features.length; i++) {
            var el = data.features[i];
            if (el.geometry.coordinates) {
              var result = el.geometry.coordinates.map(function(coord) {
                return coord.join(",");
              });
              //console.log(max_x, max_y, min_x, min_y);
              var poly = document.createElementNS(svgns, "polyline");
              poly.setAttribute("points", result.join(" "));
              svg.appendChild(poly);
              //console.log(result.join(" "));
            }
          }
          console.log("drawing", new Date().valueOf() - start.valueOf());
          parent.appendChild(svg);
          requestAnimationFrame(function() {
            console.log("drawn", new Date().valueOf() - start.valueOf());
          });
        }
      });
    });
  </script>
  <style>
polyline {
  fill: none; stroke: black; stroke-width: 0.5px;
}
  </style>
</head>
<body>
  <svg id="svg" xmlns="http://www.w3.org/2000/svg" version="1.1" style="border: 1px solid black; height: 570px; width: 700px">
    <polyline points="0,0 1,1" />
  </svg>
</body>
</html>
